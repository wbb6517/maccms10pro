<!--
============================================================
【视图模板文件 - 安装第二步：环境检测】
文件位置: application/install/view/index/step2.html
控制器调用: Index::step2() -> $this->fetch('install@index/step2')

【数据来源映射】
┌─────────────────────────────────────────────────────────────┐
│ 控制器 step2() 方法准备的数据:                               │
│                                                             │
│ $data['env']  - 环境检测结果 (操作系统、PHP版本)             │
│   ↑ 来自: checkNnv() 方法                                   │
│   ↑ 数据结构: [名称, 最低要求, 推荐配置, 当前值, 状态]       │
│                                                             │
│ $data['dir']  - 目录权限检测结果                             │
│   ↑ 来自: checkDir() 方法                                   │
│   ↑ 数据结构: [类型, 路径, 所需权限, 当前权限, 状态]         │
│                                                             │
│ $data['func'] - 函数/扩展检测结果                            │
│   ↑ 来自: checkFunc() 方法                                  │
│   ↑ 数据结构: [名称, 检测结果, 状态, 类型]                   │
│                                                             │
│ 状态值: 'ok'/'yes' = 通过(绿色勾), 'no' = 失败(红色叉)       │
└─────────────────────────────────────────────────────────────┘

【页面布局说明】
- 顶部: 环境检测标题
- 左表格: 函数/扩展检测 (pdo, curl, zip 等)
- 右表格: 目录/文件权限检测
- 底部: 返回上一步、进行下一步、常见问题解决办法 按钮
============================================================
-->

<!-- 【包含头部模板】head.html -->
{include file="../../../application/install/view/index/head" /}

<!-- 【页面专用样式】覆盖默认样式 -->
<style type="text/css">
    /* 表格边框样式 */
    .layui-table {
        border: 1px solid #E6E7EB;
    }

    /* 表格单元格样式 */
    .layui-table td,
    .layui-table th {
        text-align: center;
        font-size: 14px;
        color: #4B5563;
    }

    /* 表头样式 */
    .layui-table th {
        background: #E6E7EB;
        color: #1F2937;
    }

    /* 【状态图标】检测通过 - 绿色勾 (yes状态) */
    .layui-table tbody tr.yes td:last-child::before {
        content: '';
        display: inline-block;
        width: 16px;
        vertical-align: middle;
        height: 16px;
        margin-right: 4px;
        background: url(__STATIC__/images/install/monitor_ic_check.png) 100% 100%;
    }

    /* 【状态图标】检测通过 - 绿色勾 (ok状态) */
    .layui-table tbody tr.ok td:last-child::before {
        content: '';
        display: inline-block;
        width: 16px;
        height: 16px;
        vertical-align: middle;
        margin-right: 4px;
        background: url(__STATIC__/images/install/monitor_ic_check.png) 100% 100%;
    }

    /* 【状态图标】检测失败 - 红色叉 (no状态) */
    .layui-table tbody tr.no td:last-child::before {
        content: '';
        display: inline-block;
        vertical-align: middle;
        width: 16px;
        height: 16px;
        margin-right: 4px;
        background: url(__STATIC__/images/install/monitor_ic_wrong.png) 100% 100%;
    }

    /* 安装盒子宽度 - 比首页更宽以容纳两个表格 */
    .install-box {
        width: 1400px;
    }

    /* 环境检测标题样式 */
    .title-run {
        height: 28px;
        font-family: PingFangSC, PingFang SC;
        font-weight: 500;
        font-size: 20px;
        color: #1F2937;
        line-height: 28px;
        text-align: center;
        font-style: normal;
    }

    /* 两个表格的flex容器 */
    .word-box {
        display: flex;
        gap: 20px;
    }

    /* 返回按钮样式 */
    .step-btns .last {
        width: 300px;
        height: 40px;
        background: rgba(64, 204, 146, 0.2);
        border-radius: 6px;
        color: rgba(64, 204, 146, 1);
    }

    /* 常见问题按钮样式 */
    .step-btns .common {
        width: 300px;
        height: 40px;
        background: #FFFFFF;
        box-shadow: 0px 1px 3px 0px #EBEDF0;
        border-radius: 6px;
        border: 1px solid #E6E7EB;
        color: rgba(31, 41, 55, 1);
    }
</style>

<div class="install-box">
    <!-- 【页面标题】环境检测 -->
    <div class="title-run">
        {:lang('install/environment_title')}
    </div>

    <!--
    ============================================================
    【表格1: 运行环境检测】
    数据来源: $data['env'] - 由 checkNnv() 方法生成

    checkNnv() 检测项目:
    - 操作系统: PHP_OS 常量获取
    - PHP版本: PHP_VERSION 常量获取，要求 >= 5.5

    数据结构: [$vo[0]=名称, $vo[1]=最低版本, $vo[2]=推荐配置, $vo[3]=当前值, $vo[4]=状态]
    ============================================================
    -->
    <table class="layui-table" lay-skin="line">
        <thead>
            <tr>
                <th>{:lang('install/environment_name')}</th>
                <th>{:lang('install/required_config')}</th>
                <th>{:lang('install/current_config')}</th>
            </tr>
        </thead>
        <tbody>
            <!-- volist 循环遍历环境检测结果 -->
            {volist name="data.env" id="vo"}
            <!-- class="{$vo[4]}" 根据状态(ok/no)显示不同图标 -->
            <tr class="{$vo[4]}">
                <td>{$vo[0]}</td>  <!-- 检测项名称: 操作系统/PHP版本 -->
                <td>{$vo[2]}</td>  <!-- 推荐配置 -->
                <td>{$vo[3]}</td>  <!-- 当前配置值 -->
            </tr>
            {/volist}
        </tbody>
    </table>

    <!-- 【双表格容器】左右并排显示 -->
    <div class="word-box">
        <!--
        ============================================================
        【表格2: 函数/扩展检测】
        数据来源: $data['func'] - 由 checkFunc() 方法生成

        checkFunc() 检测项目:
        - pdo: PDO类是否存在 (数据库访问抽象层)
        - pdo_mysql: PDO MySQL驱动扩展
        - zip: ZIP压缩扩展 (用于插件安装)
        - fileinfo: 文件信息扩展 (用于MIME类型检测)
        - curl: cURL扩展 (用于采集和API调用)
        - xml: XML函数 (用于解析XML数据)
        - file_get_contents: 文件读取函数
        - mb_strlen: 多字节字符串函数

        数据结构: [$vo[0]=名称, $vo[1]=检测结果, $vo[2]=状态, $vo[3]=类型]
        类型: 类/模块/函数/配置
        ============================================================
        -->
        <table class="layui-table" lay-skin="line">
            <thead>
                <tr>
                    <th>{:lang('install/func_ext')}</th>   <!-- 函数/扩展 -->
                    <th>{:lang('install/type')}</th>       <!-- 类型 -->
                    <th>{:lang('install/result')}</th>     <!-- 结果 -->
                </tr>
            </thead>
            <tbody>
                {volist name="data.func" id="vo"}
                <tr class="{$vo[2]}">  <!-- yes/no 状态决定图标 -->
                    <td>{$vo[0]}</td>  <!-- 扩展/函数名称 -->
                    <td>{$vo[3]}</td>  <!-- 类型: 类/模块/函数 -->
                    <td>{$vo[1]}</td>  <!-- 检测结果: 支持/不支持 -->
                </tr>
                {/volist}
            </tbody>
        </table>

        <!--
        ============================================================
        【表格3: 目录/文件权限检测】
        数据来源: $data['dir'] - 由 checkDir() 方法生成

        checkDir() 检测项目:
        - ./application/database.php  数据库配置文件
        - ./application/route.php     路由配置文件
        - ./application/extra         扩展配置目录
        - ./application/data/backup   数据备份目录
        - ./application/data/update   更新目录
        - ./runtime                   运行时缓存目录
        - ./upload                    上传文件目录

        数据结构: [$vo[0]=类型, $vo[1]=路径, $vo[2]=所需权限, $vo[3]=当前权限, $vo[4]=状态]
        ============================================================
        -->
        <table class="layui-table" lay-skin="line">
            <thead>
                <tr>
                    <th>{:lang('install/dir_file')}</th>       <!-- 目录/文件 -->
                    <th>{:lang('install/required_popedom')}</th> <!-- 所需权限 -->
                    <th>{:lang('install/current_popedom')}</th>  <!-- 当前权限 -->
                </tr>
            </thead>
            <tbody>
                {volist name="data.dir" id="vo"}
                <tr class="{$vo[4]}">  <!-- ok/no 状态决定图标 -->
                    <td>{$vo[1]}</td>  <!-- 目录/文件路径 -->
                    <td>{$vo[2]}</td>  <!-- 所需权限: 读写 -->
                    <td>{$vo[3]}</td>  <!-- 当前权限: 读写/不可写/不存在 -->
                </tr>
                {/volist}
            </tbody>
        </table>
    </div>

    <!--
    【操作按钮区域】
    - 返回上一步: ?index → 回到首页
    - 进行下一步: ?step=3 → 进入数据库配置步骤
    - 常见问题: 外链到官方FAQ文档
    -->
    <div class="step-btns">
        <a href="?index" class="last layui-btn layui-btn-primary layui-btn-big fl">{:lang('install/back_step')}</a>

        <a href="?step=3" class="layui-btn layui-btn-big layui-btn-normal fl">{:lang('install/next_step')}</a><div style="padding: 9px 9px !important;" class="layui-form-mid layui-word-aux">{:lang('install/next_step_tips')}</div>

        <a target="_blank" href="http://www.maccms.la/doc/v10/faq.html"
            class="layui-btn common fr">{:lang('install/question')}</a>
    </div>
</div>

<!-- 【包含底部模板】foot.html -->
{include file="../../../application/install/view/index/foot" /}