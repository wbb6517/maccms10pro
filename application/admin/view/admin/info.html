<!--
管理员编辑页面 (Admin Edit View)
============================================================

【页面说明】
后台 "用户 → 管理员" 的添加/编辑页面
用于创建新管理员或编辑现有管理员的账号和权限

【控制器方法】
Admin::info() - application/admin/controller/Admin.php

【访问路径】
GET  admin.php/admin/info         → 添加管理员
GET  admin.php/admin/info?id=1    → 编辑管理员
POST admin.php/admin/info         → 保存数据

【模板变量】
$info  - 管理员信息 (编辑时有数据)
$menus - 权限菜单列表 (来自 auth.php)

【表单字段说明】
┌───────────────────┬─────────────────────────────────────────┐
│ 字段名             │ 说明                                     │
├───────────────────┼─────────────────────────────────────────┤
│ admin_id          │ 管理员ID (隐藏字段)                       │
│ admin_name        │ 管理员账号 (必填)                         │
│ admin_pwd         │ 密码 (新增必填,编辑为空则不修改)           │
│ admin_status      │ 状态 (0=禁用, 1=启用)                     │
│ admin_auth[]      │ 权限数组 (多选checkbox)                   │
└───────────────────┴─────────────────────────────────────────┘

【权限配置说明】
权限菜单来自 application/admin/common/auth.php
格式: controller/action (如 vod/index, admin/info)
默认必选: index/welcome (首页)

【JS功能】
- 表单验证: admin_name 不能为空
- 全选: formCheckAll 选中所有权限
- 反选: formCheckOther 反选所有权限

============================================================
-->
{include file="../../../application/admin/view/public/head" /}
<div class="page-container p10">
    <form class="layui-form layui-form-pane" method="post" action="">
        <input id="admin_id" name="admin_id" type="hidden" value="{$info.admin_id}">
        <input type="hidden" name="__token__" value="{$Request.token}" />
        <div class="layui-form-item">
            <label class="layui-form-label">{:lang('name')}：</label>
            <div class="layui-input-block  ">
                <input type="text" class="layui-input" value="{$info.admin_name}" placeholder="" id="admin_name" name="admin_name">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">{:lang('pass')}：</label>
            <div class="layui-input-block">
                <input type="password" class="layui-input" value="{$info.admin_pwd}" placeholder="" id="admin_pwd" name="admin_pwd">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">{:lang('status')}：</label>
            <div class="layui-input-block">
                    <input name="admin_status" type="radio" id="rad-1" value="0" title="{:lang('disable')}" {if condition="$info['admin_status'] neq 1"}checked {/if}>
                    <input name="admin_status" type="radio" id="rad-2" value="1" title="{:lang('enable')}" {if condition="$info['admin_status'] eq 1"}checked {/if}>
            </div>
        </div>

        <div class="layui-form-item ">
            <label class="layui-form-label">{:lang('popedom')}：</label>
            <div class="layui-input-block">
                <blockquote class="layui-elem-quote layui-quote-nm">
                    {:lang('admin/admin/popedom_tip')}
                </blockquote>


                <div class="role-list-form ">
                    {volist name="menus" id="vo" key="k1"}
                    <dl class="role-list-form-top permission-list">
                        <dt>
                            <input type="checkbox" value="" {$vo.ck} lay-skin="primary" data-id="{$k1}" lay-filter="roleAuth1" title="{$vo.name}">
                        </dt>
                        <dd>
                            {volist name="$vo.sub" id="sub" key="k2"}
                                <input type="checkbox" value="{$sub.controller}/{$sub.action}" name="admin_auth[]" {$sub.ck} data-pid="{$k1}" title="{$sub.name}" lay-skin="primary" lay-filter="roleAuth2">
                            {/volist}
                        </dd>
                    </dl>
                    {/volist}
                </div>

            </div>
        </div>

        <div class="layui-form-item center">
            <div class="layui-input-block">
                <button type="button" class="layui-btn layui-btn-normal formCheckAll" lay-filter="formCheckAll" >{:lang('check_all')}</button>
                <button type="button" class="layui-btn layui-btn-normal formCheckOther" lay-filter="formCheckOther">{:lang('check_other')}</button>

                <button type="submit" class="layui-btn" lay-submit="" lay-filter="formSubmit" data-child="true">{:lang('btn_save')}</button>
                <button class="layui-btn layui-btn-warm" type="reset">{:lang('btn_reset')}</button>
            </div>
        </div>
    </form>

</div>
{include file="../../../application/admin/view/public/foot" /}

<script type="text/javascript">
    layui.use(['form', 'layer'], function () {
        // 操作对象
        var form = layui.form
                , layer = layui.layer
                , $ = layui.jquery;

        // 验证
        form.verify({
            admin_name: function (value) {
                if (value == "") {
                    return "{:lang('name_empty')}";
                }
            },
            admin_pwd: function (value) {
                if (value == "") {
                    return "{:lang('pass_empty')}";
                }
            }
        });

        form.on('checkbox(roleAuth1)', function(data) {
            var child = $(data.elem).parent('dt').siblings('dd').find('input');
            /* 自动选中子节点 */
            child.each(function(index, item) {
                if(item.disabled == true){

                }
                else {
                    item.checked = data.elem.checked;
                }
            });
            form.render('checkbox');
        });

        form.on('checkbox(roleAuth2)', function(data) {
            var child = $(data.elem).parent().find('input');
            var parent = $(data.elem).parent('dd').siblings('dt').find('input');
            var parent_ck= true;
            /* 自动选中子节点 */
            child.each(function(index, item) {
                if(!item.checked){
                    parent_ck = false;
                }
            });
            parent.each(function(index, item) {
                item.checked = parent_ck;
            });
            form.render('checkbox');
        });


        $('.formCheckAll').click(function(){
            var child = $('.role-list-form-top').find('input');
            /* 自动选中子节点 */
            child.each(function(index, item) {
                item.checked = true;
            });
            form.render('checkbox');
        });
        $('.formCheckOther').click(function(){
            var child = $('.role-list-form-top').find('input');
            /* 自动选中子节点 */
            child.each(function(index, item) {
                item.checked = (item.checked  ? false : true);
            });
            form.render('checkbox');
        });

    });

</script>
</body>
</html>