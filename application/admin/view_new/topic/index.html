<!--
============================================================
专题管理列表页面 (Topic List Page)
============================================================

【页面说明】
后台 "基础 → 专题管理" 的列表展示页面
支持分页、搜索、状态筛选等功能

【控制器方法】
Topic::data() - application/admin/controller/Topic.php

【访问路径】
GET admin.php/topic/data

【模板变量】
$list   - 专题列表 (以topic_id为键)
$total  - 专题总数
$page   - 当前页码
$limit  - 每页数量
$param  - 搜索参数 (用于分页URL)
$title  - 页面标题 "专题管理"

【数据结构】
$list = [
    1 => ['topic_id'=>1, 'topic_name'=>'年度盘点', 'topic_hits'=>1000, 'topic_score'=>8.5, ...],
    2 => ['topic_id'=>2, 'topic_name'=>'经典回顾', 'topic_hits'=>800, 'topic_score'=>9.0, ...],
]

【页面功能】
- 按状态筛选 (未审核/已审核)
- 按名称关键词搜索
- 分页展示专题列表
- 显示静态页面生成状态 (Y=已生成/N=待生成)
- 等级设置 (1-9, 9=幻灯片)
- 批量删除/状态/等级设置
- 图片同步功能

【CSS类说明】
- j-iframe: 点击后在 iframe 中打开 (data-full="1" 全屏)
- j-page-btns: 批量操作按钮 (需要选中行)
- j-select: 弹出选择框 (选择等级/状态)
- j-tr-del: 删除当前行
- j-search: 搜索按钮

============================================================
-->

<!-- 引入公共头部 (包含HTML头、CSS、顶部导航等) -->
{include file="../../../application/admin/view_new/public/head" /}

<!-- 页面主容器: p10 = padding: 10px -->
<div class="page-container p10">

    <!-- ============================================================
    【工具栏区域】
    包含搜索表单和批量操作按钮
    ============================================================ -->
    <div class="my-toolbar-box">

        <!-- ============================================================
        【搜索表单】
        支持状态筛选和关键词搜索
        ============================================================ -->
        <div class="mb-2">
            <form class="layui-form space-x-1 space-y-1" method="post" action="{:url('data')}">
                <!-- 状态下拉选择 -->
                <div class="layui-input-inline w150">
                    <select name="status">
                        <option value="">{:lang('select_status')}</option>
                        <!-- 未审核选项 -->
                        <option value="0" {if condition="$param['status'] == '0'" }selected {
                        /if}>{:lang('reviewed_not')}</option>
                        <!-- 已审核选项 -->
                        <option value="1" {if condition="$param['status'] == '1'" }selected {
                        /if}>{:lang('reviewed')}</option>
                    </select>
                </div>
                <!-- 关键词输入框 -->
                <div class="layui-input-inline">
                    <input type="text" autocomplete="off" placeholder="{:lang('wd')}" class="layui-input" name="wd" value="{$param['wd']|mac_filter_xss}">
                </div>
                <!-- 搜索按钮: j-search 触发表单提交 -->
                <button class="layui-btn mgl-20 j-search">{:lang('btn_search')}</button>
            </form>
        </div>

        <!-- ============================================================
        【批量操作按钮栏】
        ============================================================ -->
        <div class="flex gap-5 overflow-x-auto overflow-y-hidden">
            <!-- 添加按钮: 在iframe中打开添加页面 (全屏模式) -->
            <a data-full="1" data-href="{:url('info')}" class="layui-btn layui-btn-primary j-iframe"><i class="layui-icon">&#xe654;</i>{:lang('add')}</a>

            <!-- 批量删除按钮: 删除选中的专题 -->
            <a data-href="{:url('del')}" class="layui-btn layui-btn-primary j-page-btns confirm"><i class="layui-icon">&#xe640;</i>{:lang('del')}</a>

            <!-- 等级设置按钮: 弹出选择框设置等级 (1-9) -->
            <!-- data-checkbox="1" 表示需要先选中行才能操作 -->
            <a data-href="{:url('index/select')}?tab=topic&col=topic_level&tpl=select_level&url=topic/field" data-width="270" data-height="100" data-checkbox="1" class="layui-btn layui-btn-primary j-select"><i class="layui-icon">&#xe620;</i>{:lang('level')}</a>

            <!-- 状态设置按钮: 弹出选择框设置启用/禁用状态 -->
            <a data-href="{:url('index/select')}?tab=topic&col=topic_status&tpl=select_status&url=topic/field" data-width="470" data-height="100" data-checkbox="1" class="layui-btn layui-btn-primary j-select"><i  class="layui-icon">&#xe620;</i>{:lang('status')}</a>

            <!-- 图片同步按钮: 同步专题图片 -->
            <a class="layui-btn layui-btn-primary j-iframe" data-href="{:url('images/opt?tab=topic')}" href="javascript:;" title="{:lang('pic_sync')}"><i class="layui-icon">&#xe620;</i>{:lang('pic_sync')}</a>
        </div>
    </div>

    <!-- ============================================================
    【专题列表表单】
    包含所有专题数据，用于批量操作
    ============================================================ -->
    <form class="layui-form" method="post" id="pageListForm">
        <!-- min-w-[1240px] 设置最小宽度，超出时横向滚动 -->
        <table class="layui-table min-w-[1240px]" lay-size="sm">
            <!-- ============================================================
            【表头】
            定义各列的标题和宽度
            ============================================================ -->
            <thead>
            <tr>
                <!-- 全选复选框: lay-filter="allChoose" 用于JS监听全选事件 -->
                <th width="25"><input type="checkbox" lay-skin="primary" lay-filter="allChoose"></th>
                <th width="100">{:lang('id')}</th>           <!-- 专题ID -->
                <th >{:lang('name')}</th>                    <!-- 专题名称 -->
                <th width="50">{:lang('hits')}</th>          <!-- 点击量 -->
                <th width="60">{:lang('score')}</th>         <!-- 评分 -->
                <th width="50">{:lang('level')}</th>         <!-- 等级 (可点击修改) -->
                <th width="50">{:lang('browse')}</th>        <!-- 浏览 (静态页面状态) -->
                <th width="150">{:lang('update_time')}</th>  <!-- 更新时间 -->
                <th width="140">{:lang('opt')}</th>          <!-- 操作按钮 -->
            </tr>
            </thead>

            <!-- ============================================================
            【表格内容】
            遍历专题列表，显示每个专题的信息
            ============================================================ -->
            {volist name="list" id="vo"}
            <tr>
                <!-- 选择复选框: name="ids[]" 用于批量操作 -->
                <td><input type="checkbox" name="ids[]" value="{$vo.topic_id}" class="layui-checkbox checkbox-ids"
                           lay-skin="primary"></td>

                <!-- 专题ID -->
                <td>{$vo.topic_id}</td>

                <!-- 专题名称列: 可点击跳转到前台详情页 -->
                <td><a target="_blank" class="layui-badge-rim " href="{:mac_url_topic_detail($vo)}">{$vo.topic_name|htmlspecialchars}</a>
                    <!-- 未审核状态标记 -->
                    {if condition="$vo.topic_status eq 0"} <span class="layui-badge">{:lang('reviewed_not')}</span>{/if}
                </td>

                <!-- 点击量 -->
                <td>{$vo.topic_hits}</td>

                <!-- 评分 -->
                <td>{$vo.topic_score}</td>

                <!-- 等级列: 可点击弹出选择框修改 -->
                <td>
                    <a data-href="{:url('index/select')}?tab=topic&col=topic_level&tpl=select_level&url=topic/field&ids={$vo.topic_id}"
                       data-width="270" data-height="100" class=" j-select"><span class="layui-badge layui-bg-orange">{$vo.topic_level}</span></a>
                </td>

                <!-- 浏览列: 显示静态页面生成状态 -->
                <!-- ismake=1 表示已生成，可以直接访问 -->
                <!-- ismake=0 表示需要重新生成，点击跳转到生成页面 -->
                <td>{if condition="$vo.ismake eq 1"}<a target="_blank" class="layui-badge layui-bg-green "
                                                       href="{:mac_url_topic_detail($vo)}">Y</a>{else/}<a
                        class="layui-badge" href="{:url('make/make?ac=topic_info')}?topic={$vo.topic_id}&ref=1">N</a>{/if}
                </td>

                <!-- 更新时间: 使用 mac_day 函数格式化并添加颜色 -->
                <td>{$vo.topic_time|mac_day='color'}</td>

                <!-- 操作按钮列 -->
                <td>
                    <!-- 编辑按钮: 在iframe中打开编辑页面 -->
                    <a class="layui-badge-rim j-iframe" data-full="1" data-href="{:url('info?id='.$vo['topic_id'])}"
                       href="javascript:;" title="{:lang('edit')}">{:lang('edit')}</a>
                    <!-- 删除按钮: j-tr-del 会提示确认 -->
                    <a class="layui-badge-rim j-tr-del" data-href="{:url('del?ids='.$vo['topic_id'])}"
                       href="javascript:;" title="{:lang('del')}">{:lang('del')}</a>
                </td>
            </tr>
            {/volist}
            </tbody>
        </table>

        <!-- 分页容器: 由 laypage 组件渲染 -->
        <div id="pages" class="center"></div>
    </form>
</div>

<!-- 引入公共尾部 (包含通用JS、Layui初始化等) -->
{include file="../../../application/admin/view_new/public/foot" /}

<!-- ============================================================
【页面JavaScript】
初始化 Layui 分页组件
============================================================ -->
<script type="text/javascript">
    /**
     * 当前页面URL模板
     * {page} 和 {limit} 是占位符，由分页组件动态替换
     */
    var curUrl = "{:url('topic/data',$param)}";

    layui.use(['laypage', 'layer', 'form'], function () {
        var laypage = layui.laypage  // 分页组件
            , layer = layui.layer,   // 弹层组件
            form = layui.form;       // 表单组件

        /**
         * 初始化分页组件
         * - count: 总记录数
         * - limit: 每页数量
         * - curr: 当前页码
         * - layout: 分页布局组件
         * - jump: 页码跳转回调
         */
        laypage.render({
            elem: 'pages'                                           // 分页容器ID
            , count: {$total}                                       // 总记录数
            , limit: {$limit}                                       // 每页数量
            , curr: {$page}                                         // 当前页码
            , layout: ['count', 'prev', 'page', 'next', 'limit', 'skip']  // 布局组件
            , jump: function (obj, first) {
                // first=true 表示首次加载，不需要跳转
                if (!first) {
                    // 替换URL中的占位符并跳转
                    // %7B 和 %7D 是 { 和 } 的URL编码
                    location.href = curUrl.replace('%7Bpage%7D', obj.curr).replace('%7Blimit%7D', obj.limit);
                }
            }
        });


    });
</script>
</body>
</html>