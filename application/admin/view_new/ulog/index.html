<!--
用户访问日志列表页面 (Ulog List View)
============================================================

【页面说明】
后台 "用户 → 访问日志" 的列表管理页面
显示所有用户的浏览、收藏、播放、下载等访问记录

【控制器方法】
Ulog::index() - application/admin/controller/Ulog.php

【访问路径】
GET admin.php/ulog/index
GET admin.php/ulog/index?uid=1 (查看指定用户的日志)

【模板变量】
$list  - 日志列表数组
  - ulog_id     : 日志ID
  - user_id     : 用户ID
  - user_name   : 用户名（关联查询）
  - ulog_mid    : 模型类型（1=视频, 2=文章, 3=专题, 8=演员）
  - ulog_type   : 日志类型（1=浏览, 2=收藏, 3=想看, 4=播放, 5=下载）
  - ulog_rid    : 关联内容ID
  - ulog_sid    : 播放组索引
  - ulog_nid    : 集数索引
  - ulog_points : 消费积分
  - ulog_time   : 记录时间
  - data        : 关联内容信息（name, pic, link）
$total - 总记录数
$page  - 当前页码
$limit - 每页条数
$param - 请求参数

【筛选功能】
┌──────────────┬─────────────────────────────┐
│ 筛选项        │ 说明                         │
├──────────────┼─────────────────────────────┤
│ mid          │ 模型类型（视频/文章/专题/演员）│
│ type         │ 日志类型（浏览/收藏/想看/播放/下载）│
│ wd           │ 搜索（暂不支持）              │
└──────────────┴─────────────────────────────┘

【操作按钮】
- 删除：删除选中的日志
- 清空：清空所有日志

【显示转换函数】
- mac_get_mid_text：模型ID转文字
- mac_get_ulog_type_text：日志类型转文字
- mac_day：时间戳转日期显示

============================================================
-->
{include file="../../../application/admin/view_new/public/head" /}
<div class="page-container p10">

    <div class="my-toolbar-box" >
        <div class="mb-2">
            <form class="layui-form space-x-1 space-y-1" method="post" action="{:url('index')}">
                <div class="layui-input-inline w150">
                    <select name="mid">
                        <option value="">{:lang('select_model')}</option>
                        <option value="1" {if condition="$param['mid'] eq '1'"}selected {/if}>{:lang('vod')}</option>
                        <option value="2" {if condition="$param['mid'] eq '2'"}selected {/if}>{:lang('art')}</option>
                        <option value="3" {if condition="$param['mid'] eq '3'"}selected {/if}>{:lang('topic')}</option>
                        <option value="8" {if condition="$param['mid'] eq '8'"}selected {/if}>{:lang('actor')}</option>
                    </select>
                </div>
                <div class="layui-input-inline w150">
                    <select name="type">
                        <option value="">{:lang('select_genre')}</option>
                        <option value="1" {if condition="$param['type'] eq '1'"}selected {/if}>{:lang('browse')}</option>
                        <option value="2" {if condition="$param['type'] eq '2'"}selected {/if}>{:lang('favorites')}</option>
                        <option value="3" {if condition="$param['type'] eq '3'"}selected {/if}>{:lang('want_see')}</option>
                        <option value="4" {if condition="$param['type'] eq '4'"}selected {/if}>{:lang('play')}</option>
                        <option value="5" {if condition="$param['type'] eq '5'"}selected {/if}>{:lang('down')}</option>
                    </select>
                </div>
                <div class="layui-input-inline">
                    <input type="text" autocomplete="off" placeholder="{:lang('wd')}" class="layui-input" name="wd" value="{$param['wd']|mac_filter_xss}">
                </div>
                <button class="layui-btn mgl-20 j-search" >{:lang('btn_search')}</button>
            </form>
        </div>

        <div class="flex gap-5 overflow-x-auto overflow-y-hidden">
            <a data-href="{:url('del')}" class="layui-btn layui-btn-primary j-page-btns confirm"><i class="layui-icon">&#xe640;</i>{:lang('del')}</a>
            <a data-href="{:url('del')}?ids=1&all=1" class="layui-btn layui-btn-primary j-ajax" confirm="{:lang('clear_confirm')}"><i class="layui-icon">&#xe640;</i>{:lang('clear')}</a>
        </div>
    </div>

     <form class="layui-form " method="post" id="pageListForm">
         <table class="layui-table min-w-[1240px]" lay-size="sm">
            <thead>
            <tr>
                <th width="25"><input type="checkbox" lay-skin="primary" lay-filter="allChoose"></th>
                <th width="80">{:lang('id')}</th>
                <th width="100">{:lang('user')}</th>
                <th width="50">{:lang('model')}</th>
                <th width="50">{:lang('genre')}</th>
                <th width="50">{:lang('points')}</th>
                <th width="100">{:lang('related')}id-sid-nid</th>
                <th>{:lang('data_name')}</th>
                <th width="140">{:lang('log_time')}</th>
                <th width="100">{:lang('opt')}</th>
            </tr>
            </thead>

            {volist name="list" id="vo"}
            <tr>
                <td><input type="checkbox" name="ids[]" value="{$vo.ulog_id}" class="layui-checkbox checkbox-ids" lay-skin="primary"></td>
                <td>{$vo.ulog_id}</td>
                <td>[{$vo.user_id}]{$vo.user_name}</td>
                <td>{$vo.ulog_mid|mac_get_mid_text}</td>
                <td>{$vo.ulog_type|mac_get_ulog_type_text}</td>
                <td>{$vo.ulog_points}</td>
                <td>{$vo.ulog_rid} {if condition="$vo.ulog_sid gt 0"}-{$vo.ulog_sid}{/if}{if condition="$vo.ulog_nid gt 0"}-{$vo.ulog_nid}{/if}</td>
                <td>[{$vo.data.name}]</td>
                <td>{$vo.ulog_time|mac_day='color'}</td>
                <td>
                    <a class="layui-badge-rim j-tr-del" data-href="{:url('del?ids='.$vo['ulog_id'])}" href="javascript:;" title="{:lang('del')}">{:lang('del')}</a>
                </td>
            </tr>
            {/volist}
            </tbody>
        </table>

        <div id="pages" class="center"></div>

    </form>
</div>

{include file="../../../application/admin/view_new/public/foot" /}


<script type="text/javascript">
    var curUrl="{:url('ulog/index',$param)}";
    layui.use(['laypage', 'layer'], function() {
        var laypage = layui.laypage
                , layer = layui.layer;

        laypage.render({
            elem: 'pages'
            ,count: {$total}
            ,limit: {$limit}
            ,curr: {$page}
            ,layout: ['count', 'prev', 'page', 'next', 'limit', 'skip']
            ,jump: function(obj,first){
                if(!first){
                    location.href = curUrl.replace('%7Bpage%7D',obj.curr).replace('%7Blimit%7D',obj.limit);
                }
            }
        });
    });
</script>
</body>
</html>