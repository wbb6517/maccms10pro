<!--
广告代码管理页 (Ads Code Manager)
============================================================

【页面说明】
管理当前模板下的广告 JS 文件，提供广告代码的新增、编辑、删除功能。
支持一键复制广告调用代码，方便在模板中嵌入广告。

【控制器方法】
Template::ads() - application/admin/controller/Template.php

【访问路径】
GET admin.php/template/ads  广告文件列表

【模板变量】
$curpath   - 当前广告目录路径
$files     - 广告文件列表数组，包含：
             - isfile : 是否为文件 (固定为1)
             - name   : 文件名
             - path   : 文件路径
             - fullname : 完整路径
             - size   : 文件大小
             - note   : 类型描述
             - time   : 修改时间
$num_file  - 文件数量
$sum_size  - 总文件大小

【表格字段说明】
┌──────────────────┬─────────────────────────────────────────┐
│ 字段名            │ 说明                                     │
├──────────────────┼─────────────────────────────────────────┤
│ file_name        │ 广告文件名                               │
│ file_des         │ 类型描述（文件）                          │
│ file_size        │ 文件大小                                 │
│ file_time        │ 修改时间                                 │
│ call_code        │ 广告调用代码（可复制的 script 标签）      │
│ opt              │ 操作按钮（复制/编辑/删除）                │
└──────────────────┴─────────────────────────────────────────┘

【JS功能】
- ClipboardJS 剪贴板复制功能
- data_info(path, name) : 打开文件编辑弹窗
- data_del(id)          : 删除文件确认

【调用代码格式】
<script src="{$maccms.path_ads}xxx.js"></script>

============================================================
-->

<!-- 引入公共头部 -->
{include file="../../../application/admin/view_new/public/head" /}
<div class="page-container p10">
    <div class="my-btn-box lh30" >
        <div class="flex gap-5 overflow-x-auto overflow-y-hidden">
            <a data-full="1" data-href="{:url('info')}?fpath={$curpath}&fname=" class="layui-btn layui-btn-primary j-iframe"><i class="layui-icon">&#xe654;</i>{:lang('add')}</a>
        </div>
        <div class="page-filter fr" >

        </div>
    </div>

    <form class="layui-form layui-form-pane" action="">
        <table class="layui-table mt10">
        <thead>
        <tr>
            <th>{:lang('file_name')}</th>
            <th width="150">{:lang('file_des')}</th>
            <th width="150">{:lang('file_size')}</th>
            <th width="150">{:lang('file_time')}</th>
            <th width="200">{:lang('admin/template/call_code')}</th>
            <th width="300">{:lang('opt')}</th>
        </tr>
        </thead>
            {volist name="files" id="vo"}
            <tr>

                <th>{$vo.name}</a></th>
                <td>{$vo.note}</td>
                <td>{$vo.size}</td>
                <td>{$vo.time|mac_day='color'}</td>
                <td>
                    <input id="txt{$key}" type="text" value='<script src="{literal}{$maccms.path_ads}{/literal}{$vo.name}"></script>' size="60">
                </td>
                <td>
                    <a class="layui-badge-rim j-clipboard" data-clipboard-target="#txt{$key}" href="javascript:;" title="{:lang('copy')}">{:lang('copy')}</a>
                    <a class="layui-badge-rim j-iframe" data-full="1" data-href="{:url('info')}?fpath={$vo.path}&fname={$vo.name}" href="javascript:;" title="{:lang('edit')}">{:lang('edit')}</a>
                    <a class="layui-badge-rim j-tr-del" data-href="{:url('del')}?fname={$vo.fullname}" href="javascript:;" title="{:lang('del')}">{:lang('del')}</a>
                </td>
            </tr>
            {/volist}
        </tbody>
        <tfoot>
            <tr><td colspan="6">{:lang('admin/template/current_dir')}：{$curpath|str_replace='@','/',###}，{:lang('sum')}<b class="red">{$num_file}</b>{:lang('file')},{:lang('occupies')}<b class="red">{$sum_size}</b>{:lang('space')}</td></tr>
        </tfoot>
    </table>
    </form>
</div>
{include file="../../../application/admin/view_new/public/foot" /}
<script type="text/javascript" src="__STATIC__/js/jquery.clipboard.js"></script>
<script type="text/javascript">
    var clipboard = new ClipboardJS('.j-clipboard');
    clipboard.on('success', function(e) {
       layer.msg('copy ok');
    });

    function data_info(path,name)
    {
        var index = layer.open({
            type: 2,
            shade:0.4,
            title: "{:lang('edit')}",
            content: "{:url('template/info')}?fpath="+path+'&fname='+name
        });

        layer.full(index);
    }

    function data_del(id)
    {
        if(!id){
            id  = checkIds('fname[]');
        }
        layer.confirm("{:lang('del_confirm')}", function (index) {
            location.href = "{:url('template/del')}?fname=" + id;
        });
    }

    $(function(){

    });
</script>
</body>
</html>