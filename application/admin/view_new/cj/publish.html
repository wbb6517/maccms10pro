<!--
已采集内容管理页 (Collected Content Management)
============================================================

【页面说明】
管理指定节点下所有已采集的内容
支持按状态筛选、批量删除、批量入库

【控制器方法】
Cj::publish() - application/admin/controller/Cj.php

【访问路径】
GET admin.php/cj/publish?id=xxx&status=x

【模板变量】
$list   - 采集内容列表 (来自 mac_cj_content)
$param  - 请求参数 (含节点ID和状态)
$total  - 总记录数
$page   - 当前页码
$limit  - 每页数量

【状态筛选 Tab】
- 全部: 所有状态
- 待采集: status=1 (已采集网址)
- 已采集: status=2 (已采集内容,待入库)
- 已入库: status=3 (已写入正式表)

【工具栏操作】
- 删除: 删除选中内容
- 清空: 删除全部内容
- 入库: 将选中内容入库
- 全部入库: 入库所有已采集内容

============================================================
-->

{include file="../../../application/admin/view_new/public/head" /}
<div class="page-container">
    <form class="layui-form layui-form-pane" action="">
        <div class="layui-tab">
            <ul class="layui-tab-title">
                <li {if condition="$param.status eq ''"}class="layui-this"{/if}><a href="{:url('cj/publish')}?id={$param.id}">{:lang('all')}</a></li>
                <li {if condition="$param.status eq '1'"}class="layui-this"{/if}><a href="{:url('cj/publish')}?id={$param.id}&status=1">{:lang('admin/cj/collected_not')}</a></li>
                <li {if condition="$param.status eq '2'"}class="layui-this"{/if}><a href="{:url('cj/publish')}?id={$param.id}&status=2">{:lang('admin/cj/collected')}</a></li>
                <li {if condition="$param.status eq '3'"}class="layui-this"{/if}><a href="{:url('cj/publish')}?id={$param.id}&status=3">{:lang('admin/cj/published')}</a></li>
            </ul>

            <div class="layui-tab-content">
                <div class="layui-tab-item layui-show">
                    <div class="layui-btn-group">
                        <a data-href="{:url('content_del')}" class="layui-btn layui-btn-primary j-page-btns confirm"><i class="layui-icon">&#xe640;</i>{:lang('del')}</a>
                        <a data-href="{:url('content_del')}?ids=1&all=1" class="layui-btn layui-btn-primary j-ajax" confirm="{:lang('clear_confirm')}"><i class="layui-icon">&#xe640;</i>{:lang('clear')}</a>
                        <a data-href="{:url('content_into')}?id={$param.id}" data-ajax="no" class="layui-btn layui-btn-primary j-page-btns confirm"><i class="layui-icon">&#xe654;</i>{:lang('import')}</a>
                        <a data-href="{:url('content_into')}?id={$param.id}&all=1" data-ajax="no" data-checkbox="no" class="layui-btn layui-btn-primary j-page-btns confirm"><i class="layui-icon">&#xe654;</i>{:lang('import_all')}</a>
                    </div>
                    <table class="layui-table" lay-size="sm">
                        <thead>
                        <tr>
                            <th width="25"><input type="checkbox" lay-skin="primary" lay-filter="allChoose"></th>
                            <th width="50">{:lang('id')}</th>
                            <th width="50">{:lang('status')}</th>
                            <th width="250">{:lang('name')}</th>
                            <th >{:lang('url')}</th>
                            <th width="40">{:lang('opt')}</th>
                        </tr>
                        </thead>
                        {volist name="list" id="vo"}
                        <tr>
                            <td><input type="checkbox" name="ids[]" value="{$vo.id}" class="layui-checkbox checkbox-ids" lay-skin="primary"></td>
                            <td>{$vo.id}</td>
                            <td>{if condition="$vo.status eq '1'"}{:lang('admin/cj/collected_not')}{elseif condition="$vo.status eq '2'"}{:lang('admin/cj/collected')}{else/}{:lang('admin/cj/published')}{/if}</td>
                            <td>{$vo.title}</td>
                            <td>{$vo.url}</td>
                            <td>
                                <a class="layui-badge-rim j-iframe " data-href="{:url('show?id='.$vo['id'])}" href="javascript:;" title="{:lang('view')}">{:lang('view')}</a>
                            </td>
                        </tr>
                        {/volist}
                        </tbody>
                    </table>

                    <div id="pages" class="center"></div>

                </div>

            </div>
        </div>

    </form>
</div>

{include file="../../../application/admin/view_new/public/foot" /}
<script type="text/javascript">
    var curUrl="{:url('cj/publish',$param)}";
    layui.use(['laypage', 'layer'], function() {
        var laypage = layui.laypage
                , layer = layui.layer;

        laypage.render({
            elem: 'pages'
            ,count: {$total}
            ,limit: {$limit}
            ,curr: {$page}
            ,layout: ['count', 'prev', 'page', 'next', 'limit', 'skip']
            ,jump: function(obj,first){
                if(!first){
                    location.href = curUrl.replace('%7Bpage%7D',obj.curr).replace('%7Blimit%7D',obj.limit);
                }
            }
        });
    });
</script>

</body>
</html>