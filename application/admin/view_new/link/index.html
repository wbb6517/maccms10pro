<!--
============================================================
友情链接列表页面 (Link List Page)
============================================================

【页面说明】
后台 "基础 → 友情链接" 的列表管理页面
展示所有友情链接，支持搜索、批量编辑和删除

【控制器方法】
Link::index() - application/admin/controller/Link.php

【访问路径】
GET admin.php/link/index

【模板变量】
$list   - 友链列表数据
$total  - 总记录数
$page   - 当前页码
$limit  - 每页条数
$param  - 搜索参数

【页面功能】
- 按名称关键词搜索友链
- 分页展示友链列表
- 列表内直接编辑 (排序/类型/名称/URL/Logo)
- 添加新友链 (弹窗)
- 批量编辑保存
- 删除友链 (支持批量)
- 检测友链是否有效 (回链检测)

【列表字段说明】
┌────────────┬─────────────────────────────────────────┐
│ 列名        │ 说明                                     │
├────────────┼─────────────────────────────────────────┤
│ 选择框      │ 用于批量操作                             │
│ ID         │ 友链ID                                   │
│ 排序        │ 排序值 (可直接编辑)                      │
│ 类型        │ 文字链接/图片链接 (下拉选择)             │
│ 名称        │ 友链名称 (可直接编辑)                    │
│ URL        │ 链接地址 (可直接编辑)                    │
│ Logo       │ Logo图片地址 (可直接编辑)                │
│ 操作        │ 检测/编辑/删除                          │
└────────────┴─────────────────────────────────────────┘

【特殊功能】
- 回链检测: 检查对方网站是否包含本站链接

============================================================
-->

<!-- 引入公共头部 -->
{include file="../../../application/admin/view_new/public/head" /}

<!-- 页面主容器 -->
<div class="page-container p10">

    <!-- ============================================================
    【工具栏区域】
    包含搜索表单和操作按钮
    ============================================================ -->
    <div class="my-toolbar-box">
        <!-- 搜索表单 -->
        <div class=" mb10">
            <form class="layui-form " method="post" action="{:url('index')}">
                <!-- 关键词搜索框 -->
                <div class="layui-input-inline">
                    <input type="text" autocomplete="off" placeholder="{:lang('wd')}" class="layui-input" name="wd" value="{$param['wd']|mac_filter_xss}">
                </div>
                <button class="layui-btn mgl-20 j-search" >{:lang('btn_search')}</button>
            </form>
        </div>

        <!-- 操作按钮组 -->
        <div class="flex gap-5 overflow-x-auto overflow-y-hidden">
            <!-- 添加按钮: 在iframe弹窗中打开编辑页面 -->
            <a data-href="{:url('info')}" class="layui-btn layui-btn-primary j-iframe"><i class="layui-icon">&#xe654;</i>{:lang('add')}</a>
            <!-- 批量编辑: 保存列表中直接修改的内容 -->
            <a data-href="{:url('batch')}" class="layui-btn layui-btn-primary j-page-btns confirm"><i class="layui-icon">&#xe642;</i>{:lang('edit')}</a>
            <!-- 批量删除: 删除选中的友链 -->
            <a data-href="{:url('del')}" class="layui-btn layui-btn-primary j-page-btns confirm"><i class="layui-icon">&#xe640;</i>{:lang('del')}</a>
        </div>

    </div>

    <!-- ============================================================
    【友链列表表单】
    整个表格在form中，用于批量提交编辑
    ============================================================ -->
    <form class="layui-form " method="post" id="pageListForm">
        <table class="layui-table" lay-size="sm">
        <thead>
            <tr>
                <!-- 全选复选框 -->
                <th width="25"><input type="checkbox" lay-skin="primary" lay-filter="allChoose"></th>
                <th width="100">{:lang('id')}</th>       <!-- ID -->
                <th width="100">{:lang('sort')}</th>     <!-- 排序 -->
                <th width="150">{:lang('genre')}</th>    <!-- 类型 -->
                <th >{:lang('name')}</th>                <!-- 名称 -->
                <th >{:lang('url')}</th>                 <!-- URL -->
                <th >{:lang('logo')}</th>                <!-- Logo -->
                <th width="230">{:lang('opt')}</th>      <!-- 操作 -->
            </tr>
            </thead>

            <!-- 循环输出友链列表 -->
            {volist name="list" id="vo"}
            <tr>
                <!-- 选择框: 用于批量操作 -->
                <td><input type="checkbox" name="ids[]" value="{$vo.link_id}" class="layui-checkbox checkbox-ids" lay-skin="primary"></td>
                <!-- ID列 -->
                <td>{$vo.link_id}</td>
                <!-- 排序: 可直接编辑的输入框 -->
                <td><input type="input" name="link_sort[]" value="{$vo.link_sort}" class="layui-input"></td>
                <!-- 类型: 下拉选择 (0=文字链接, 1=图片链接) -->
                <td>
                    <select name="link_type[]">
                        <option value="0" {if condition="$vo['link_type'] eq 0"}selected {/if}>{:lang('admin/link/text_link')}</option>
                        <option value="1" {if condition="$vo['link_type'] eq 1"}selected {/if}>{:lang('admin/link/pic_link')}</option>
                    </select>
                </td>
                <!-- 名称: 可直接编辑 -->
                <td><input type="input" name="link_name[]" value="{$vo.link_name}" class="layui-input"></td>
                <!-- URL: 可直接编辑 -->
                <td><input type="input" name="link_url[]" value="{$vo.link_url}" class="layui-input"></td>
                <!-- Logo: 可直接编辑 -->
                <td><input type="input" name="link_logo[]" value="{$vo.link_logo}" class="layui-input"></td>
                <!-- 操作列 -->
                <td>
                    <!-- 检测按钮: 检查对方网站是否有回链 -->
                    <a class="layui-badge-rim j-ajax" data-href="{:url('index/check_back_link')}?url={$vo['link_url']}" refresh="no" href="javascript:;" title="{:lang('detect')}">{:lang('detect')}</a>
                    <!-- 编辑按钮: 在弹窗中打开详细编辑页面 -->
                    <a class="layui-badge-rim j-iframe" data-href="{:url('info?id='.$vo['link_id'])}" href="javascript:;" title="{:lang('edit')}">{:lang('edit')}</a>
                    <!-- 删除按钮: 删除当前行 -->
                    <a class="layui-badge-rim j-tr-del" data-href="{:url('del?ids='.$vo['link_id'])}" href="javascript:;" title="{:lang('del')}">{:lang('del')}</a>
                </td>
            </tr>
            {/volist}
            </tbody>
        </table>
        <!-- 分页容器 -->
        <div id="pages" class="center"></div>

    </form>
</div>

<!-- 引入公共尾部 -->
{include file="../../../application/admin/view_new/public/foot" /}


<!-- ============================================================
【分页JavaScript】
使用 Layui 的 laypage 组件实现分页
============================================================ -->
<script type="text/javascript">
    // 当前页面URL模板，{page}和{limit}会被实际值替换
    var curUrl="{:url('link/index',$param)}";
    layui.use(['laypage', 'layer'], function() {
        var laypage = layui.laypage
                , layer = layui.layer;

        // 渲染分页组件
        laypage.render({
            elem: 'pages'              // 分页容器ID
            ,count: {$total}           // 总记录数
            ,limit: {$limit}           // 每页条数
            ,curr: {$page}             // 当前页码
            ,layout: ['count', 'prev', 'page', 'next', 'limit', 'skip']  // 分页布局
            ,jump: function(obj,first){
                // first=true 表示首次渲染，不执行跳转
                if(!first){
                    // 替换URL中的占位符并跳转
                    location.href = curUrl.replace('%7Bpage%7D',obj.curr).replace('%7Blimit%7D',obj.limit);
                }
            }
        });
    });

</script>
</body>
</html>