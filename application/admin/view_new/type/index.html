<!--
============================================================
分类管理列表页面 (Type List Page)
============================================================

【页面说明】
后台 "基础 → 分类管理" 的列表展示页面
以树形结构展示所有分类 (一级分类 + 二级子分类)

【控制器方法】
Type::index() - application/admin/controller/Type.php

【访问路径】
GET admin.php/type/index

【模板变量】
$list   - 分类树形列表 (一级分类包含 child 子数组)
$total  - 分类总数
$title  - 页面标题 "分类管理"

【数据结构】
$list = [
    ['type_id'=>1, 'type_name'=>'电影', 'type_mid'=>1, 'cc'=>100, 'child'=>[
        ['type_id'=>2, 'type_name'=>'动作片', 'cc'=>30, ...],
        ['type_id'=>3, 'type_name'=>'喜剧片', 'cc'=>25, ...],
    ]],
    ['type_id'=>10, 'type_name'=>'资讯', 'type_mid'=>2, 'cc'=>50, 'child'=>[...]],
]

【页面功能】
- 树形展示所有分类 (一级 + 二级)
- 显示每个分类下的内容数量 (cc 字段)
- 支持行内直接编辑 (排序/名称/英文标识/模板)
- 状态开关快速切换
- 批量操作 (编辑/删除/状态/转移)

【CSS类说明】
- j-iframe: 点击后在 iframe 中打开 (data-full="1" 全屏)
- j-page-btns: 批量操作按钮 (需要选中行)
- j-select: 弹出选择框 (选择状态/目标分类)
- j-tr-del: 删除当前行

============================================================
-->

<!-- 引入公共头部 (包含HTML头、CSS、顶部导航等) -->
{include file="../../../application/admin/view_new/public/head" /}

<!-- 页面主容器: p10 = padding: 10px -->
<div class="page-container p10">

    <!-- ============================================================
    【工具栏区域】
    包含批量操作按钮: 添加、编辑、删除、状态、转移
    ============================================================ -->
    <div class="my-toolbar-box">
        <div class="flex gap-5 overflow-x-auto overflow-y-hidden no-scrollbar">
            <!-- 添加按钮: 在iframe中打开添加页面 (全屏模式) -->
            <a data-full="1" data-href="{:url('info')}" class="layui-btn layui-btn-primary j-iframe"><i
                    class="layui-icon">&#xe654;</i>{:lang('add')}</a>

            <!-- 批量编辑按钮: 提交表单到 type/batch 保存所有行内编辑 -->
            <a data-href="{:url('batch')}" class="layui-btn layui-btn-primary j-page-btns confirm"><i
                    class="layui-icon">&#xe642;</i>{:lang('edit')}</a>

            <!-- 批量删除按钮: 删除选中的分类 -->
            <a data-href="{:url('del')}" class="layui-btn layui-btn-primary j-page-btns confirm"><i
                    class="layui-icon">&#xe640;</i>{:lang('del')}</a>

            <!-- 状态设置按钮: 弹出选择框设置启用/禁用状态 -->
            <!-- data-checkbox="1" 表示需要先选中行才能操作 -->
            <a data-href="{:url('index/select')}?tab=type&col=type_status&tpl=select_status&url=type/field"
                data-width="470" data-height="100" data-checkbox="1" class="layui-btn layui-btn-primary j-select"><i
                    class="layui-icon">&#xe620;</i>{:lang('status')}</a>

            <!-- 数据转移按钮: 弹出选择框选择目标分类 -->
            <!-- 将选中分类下的内容转移到另一个分类 -->
            <a data-href="{:url('index/select')}?tab=type&col=type_status&tpl=select_type&url=type/move"
                data-width="470" data-height="100" data-checkbox="1" class="layui-btn layui-btn-primary j-select"><i
                    class="layui-icon">&#xe620;</i>{:lang('transfer')}</a>
        </div>

    </div>

    <!-- ============================================================
    【分类列表表单】
    包含所有分类数据，支持行内编辑
    提交到 type/batch 批量保存
    ============================================================ -->
    <form class="layui-form " method="post" id="pageListForm">
        <!-- min-w-[1240px] 设置最小宽度，超出时横向滚动 -->
        <table class="layui-table min-w-[1240px]" lay-size="sm">
            <!-- ============================================================
            【表头】
            定义各列的标题和宽度
            ============================================================ -->
            <thead>
                <tr>
                    <!-- 全选复选框: lay-filter="allChoose" 用于JS监听全选事件 -->
                    <th width="25"><input type="checkbox" lay-skin="primary" lay-filter="allChoose"></th>
                    <th>{:lang('name')}</th>                     <!-- 分类名称 (带链接和数量徽章) -->
                    <th width="80">{:lang('status')}</th>        <!-- 状态开关 -->
                    <th width="80">{:lang('genre')}</th>         <!-- 分类类型 (视频/文章/演员等) -->
                    <th width="80">{:lang('sort')}</th>          <!-- 排序值 (可编辑) -->
                    <th width="80">{:lang('name')}</th>          <!-- 名称 (可编辑) -->
                    <th width="120">{:lang('en')}</th>           <!-- 英文标识 (可编辑) -->
                    <th width="100">{:lang('admin/type/type_tpl')}</th>    <!-- 分类模板 (可编辑) -->
                    <th width="100">{:lang('admin/type/show_tpl')}</th>    <!-- 列表模板 (可编辑) -->
                    <th width="100">{:lang('admin/type/detail_tpl')}</th>  <!-- 详情模板 (可编辑) -->
                    <th width="230">{:lang('opt')}</th>          <!-- 操作按钮 -->
                </tr>
            </thead>

            <!-- ============================================================
            【表格内容】
            遍历树形分类列表，先显示一级分类，再显示其子分类
            ============================================================ -->
            {volist name="list" id="vo"}
                <!-- ============================================================
                【一级分类行】
                vo 包含: type_id, type_name, type_mid, type_status, type_sort,
                         type_en, type_tpl, type_tpl_list, type_tpl_detail, cc(内容数量), child(子分类数组)
                ============================================================ -->
                <tr>
                    <!-- 选择复选框: name="ids[]" 用于批量操作 -->
                    <td><input type="checkbox" name="ids[]" value="{$vo.type_id}" class="layui-checkbox checkbox-ids"
                            lay-skin="primary"></td>

                    <!-- 分类名称列: 显示ID、名称(可点击跳转前台)、内容数量徽章 -->
                    <td>{$vo.type_id}、<a target="_blank" class="layui-badge-rim "
                            href="{:mac_url_type($vo)}">{$vo.type_name}</a>
                        <!-- cc 为该分类下的内容总数 (视频/文章等) -->
                        <span class="layui-badge">{$vo.cc}</span>
                    </td>

                    <!-- 状态开关: lay-filter="switchStatus" 用于监听开关变化 -->
                    <!-- data-href 指定状态切换的AJAX请求地址 -->
                    <td>
                        <input type="checkbox" name="status" {if condition="$vo['type_status'] eq 1" }checked{/if}
                            value="{$vo['type_status']}" lay-skin="switch" lay-filter="switchStatus"
                            data-href="{:url('field?col=type_status&ids='.$vo['type_id'])}">
                    </td>

                    <!-- 分类类型: 使用 mac_get_mid_text 函数转换为中文显示 -->
                    <!-- 1=视频, 2=文章, 8=演员, 11=网址, 12=漫画 -->
                    <td>
                        <span class="label label-success radius	">{$vo.type_mid|mac_get_mid_text}</span>
                    </td>

                    <!-- 可编辑字段: 排序值 -->
                    <!-- name格式: type_sort_{type_id}，便于批量保存时识别 -->
                    <td><input type="input" name="type_sort_{$vo.type_id}" value="{$vo.type_sort}" class="layui-input"></td>

                    <!-- 可编辑字段: 分类名称 -->
                    <td><input type="input" name="type_name_{$vo.type_id}" value="{$vo.type_name}" class="layui-input"></td>

                    <!-- 可编辑字段: 英文标识 (URL别名) -->
                    <td><input type="input" name="type_en_{$vo.type_id}" value="{$vo.type_en}" class="layui-input"></td>

                    <!-- 可编辑字段: 分类首页模板 -->
                    <td><input type="input" name="type_tpl_{$vo.type_id}" value="{$vo.type_tpl}" class="layui-input"></td>

                    <!-- 可编辑字段: 筛选列表模板 -->
                    <td><input type="input" name="type_tpl_list_{$vo.type_id}" value="{$vo.type_tpl_list}"
                            class="layui-input"></td>

                    <!-- 可编辑字段: 详情页模板 -->
                    <td><input type="input" name="type_tpl_detail_{$vo.type_id}" value="{$vo.type_tpl_detail}"
                            class="layui-input"></td>

                    <!-- 操作按钮列 -->
                    <td>
                        <!-- 编辑按钮: 在iframe中打开编辑页面 -->
                        <a class="layui-badge-rim layui-bg-green j-iframe" data-full="1"
                            data-href="{:url('info?id='.$vo['type_id'])}" href="javascript:;"
                            title="{:lang('edit')}">{:lang('edit')}</a>

                        <!-- 删除按钮: 删除当前分类 (j-tr-del 会提示确认) -->
                        <a class="layui-badge-rim layui-bg-green j-tr-del" data-href="{:url('del?ids='.$vo['type_id'])}"
                            href="javascript:;" title="{:lang('del')}">{:lang('del')}</a>

                        <!-- 添加子分类按钮: pid 参数指定父分类ID -->
                        <a class="layui-badge-rim layui-bg-green j-iframe" data-full="1"
                            data-href="{:url('info')}?pid={$vo.type_id}" href="javascript:;"
                            title="{:lang('add')}">{:lang('add')}</a>
                    </td>
                </tr>

                <!-- ============================================================
                【二级子分类行】
                遍历 vo.child 数组，显示当前一级分类下的所有子分类
                ch 包含与 vo 相同的字段结构
                ============================================================ -->
                {volist name="vo.child" id="ch"}
                <tr>
                    <!-- 选择复选框 -->
                    <td><input type="checkbox" name="ids[]" value="{$ch.type_id}" class="layui-checkbox checkbox-ids"
                            lay-skin="primary"></td>

                    <!-- 分类名称列: 使用 ├ 符号表示层级关系 -->
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;├&nbsp;{$ch.type_id}、<a target="_blank" class="layui-badge-rim "
                            href="{:mac_url_type($ch)}">{$ch.type_name}</a>
                        <span class="layui-badge">{$ch.cc}</span>
                    </td>

                    <!-- 状态开关 -->
                    <td>
                        <input type="checkbox" name="status" {if condition="$ch['type_status'] eq 1" }checked{/if}
                            value="{$ch['type_status']}" lay-skin="switch" lay-filter="switchStatus"
                            data-href="{:url('field?col=type_status&ids='.$ch['type_id'])}">
                    </td>

                    <!-- 分类类型 -->
                    <td>
                        <span class="label label-success radius	">{$ch.type_mid|mac_get_mid_text}</span>
                    </td>

                    <!-- 可编辑字段: 排序值 -->
                    <td><input type="input" name="type_sort_{$ch.type_id}" value="{$ch.type_sort}" class="layui-input"></td>

                    <!-- 可编辑字段: 分类名称 -->
                    <td><input type="input" name="type_name_{$ch.type_id}" value="{$ch.type_name}" class="layui-input"></td>

                    <!-- 可编辑字段: 英文标识 -->
                    <td><input type="input" name="type_en_{$ch.type_id}" value="{$ch.type_en}" class="layui-input"></td>

                    <!-- 可编辑字段: 分类模板 -->
                    <td><input type="input" name="type_tpl_{$ch.type_id}" value="{$ch.type_tpl}" class="layui-input"></td>

                    <!-- 可编辑字段: 列表模板 -->
                    <td><input type="input" name="type_tpl_list_{$ch.type_id}" value="{$ch.type_tpl_list}"
                            class="layui-input"></td>

                    <!-- 可编辑字段: 详情模板 -->
                    <td><input type="input" name="type_tpl_detail_{$ch.type_id}" value="{$ch.type_tpl_detail}"
                            class="layui-input"></td>

                    <!-- 操作按钮 (二级分类没有"添加子分类"按钮) -->
                    <td>
                        <!-- 编辑按钮 -->
                        <a class="layui-badge-rim layui-bg-green j-iframe" data-full="1"
                            data-href="{:url('info?id='.$ch['type_id'])}" href="javascript:;"
                            title="{:lang('edit')}">{:lang('edit')}</a>

                        <!-- 删除按钮 -->
                        <a class="layui-badge-rim layui-bg-green j-tr-del" data-href="{:url('del?ids='.$ch['type_id'])}"
                            href="javascript:;" title="{:lang('del')}">{:lang('del')}</a>
                    </td>
                </tr>
                {/volist}
            {/volist}
            </tbody>
        </table>

    </form>
</div>

<!-- 引入公共尾部 (包含通用JS、Layui初始化等) -->
{include file="../../../application/admin/view_new/public/foot" /}

<!-- ============================================================
【页面JavaScript】
初始化 Layui 组件
============================================================ -->
<script type="text/javascript">

    layui.use(['laypage', 'layer'], function () {
        var laypage = layui.laypage  // 分页组件 (本页未使用，分类不分页)
            , layer = layui.layer;   // 弹层组件

        // 注: 状态开关切换等功能由公共JS (foot.html) 中的代码处理
        // 通过 lay-filter="switchStatus" 监听开关变化
        // 通过 j-iframe、j-page-btns、j-tr-del 等CSS类触发相应操作
    });
</script>
</body>

</html>